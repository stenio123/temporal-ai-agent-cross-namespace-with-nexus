sequenceDiagram
    participant U as User
    participant C as Client
    participant S as Temporal Server
    participant W as Worker
    participant LLM as LLM API

    U->>C: Enter message
    C->>S: send_message()
    S->>S: Persist to Event Log
    S->>W: Dispatch task

    loop Agent Loop
        W->>LLM: plan_next_action()
        LLM-->>W: PlanResult
        W->>S: Store activity result
        
        alt Tool needed
            W->>W: execute_tool()
            W->>S: Store tool result
        else Ready to respond
            W-->>S: pending_response
        end
    end

    S-->>C: Return response
    C-->>U: Display response

    Note over S: On worker failure:<br/>Replay from Event Log<br/>Activity results retrieved,<br/>not re-executed